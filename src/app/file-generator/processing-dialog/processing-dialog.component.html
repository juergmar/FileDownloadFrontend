<p-dialog
  [(visible)]="visible"
  [modal]="true"
  [closable]="!isProcessing()"
  [closeOnEscape]="!isProcessing()"
  [draggable]="false"
  [resizable]="false"
  [style]="{width: '400px'}"
  [baseZIndex]="1000"
  header="Processing Report"
  (onHide)="handleDialogHide()">

  <!-- Rest of dialog content remains the same -->
  <div class="processing-container">
    <!-- Status icon -->
    <div class="status-icon" [ngClass]="{'animate-completion': job?.status === JobStatus.COMPLETED}">
      <!-- Show spinner only for PENDING or IN_PROGRESS states -->
      <div *ngIf="shouldShowSpinner()" class="spinner-container">
        <p-progressSpinner
          [style]="{'width': '80px', 'height': '80px'}"
          [strokeWidth]="'8'"
          [animationDuration]="'.5s'"
          styleClass="custom-spinner"></p-progressSpinner>
      </div>

      <!-- Show status icon for other states -->
      <i *ngIf="job?.status === JobStatus.COMPLETED" class="pi pi-check-circle" style="font-size: 3rem; color: #4caf50;"></i>
      <i *ngIf="job?.status === JobStatus.FAILED" class="pi pi-times-circle" style="font-size: 3rem; color: #f44336;"></i>
      <i *ngIf="job?.status === JobStatus.CANCELLED" class="pi pi-ban" style="font-size: 3rem; color: #ff9800;"></i>
    </div>

    <!-- Status message -->
    <h3 class="status-message">{{ getStatusMessage() }}</h3>

    <!-- File type info if available -->
    <p *ngIf="job?.fileType" class="file-info">
      {{ job?.fileType | fileType }}
    </p>

    <!-- Error message if available -->
    <div class="error-message" *ngIf="job?.status === JobStatus.FAILED && job?.failureReason">
      <i class="pi pi-exclamation-triangle"></i> {{ job?.failureReason }}
    </div>
  </div>

  <div class="status-update-info" *ngIf="isProcessing()">
    <p>
      <small>Last checked: {{ lastStatusCheckTime | date:'medium' }}</small>
      <span *ngIf="isCheckingStatus" class="ml-2">
        <i class="pi pi-spin pi-spinner" style="font-size: 0.75rem;"></i>
      </span>
    </p>
  </div>

  <ng-template pTemplate="footer">
    <!-- Close button only appears when processing is complete -->
    <p-button
      *ngIf="shouldShowCloseButton()"
      label="Close"
      icon="pi pi-times"
      (onClick)="closeDialog()">
    </p-button>

    <p-button
      *ngIf="shouldShowDownloadButton()"
      label="Download"
      icon="pi pi-download"
      styleClass="p-button-success"
      [style]="{'margin-left': '0.5rem'}"
      (onClick)="download.emit()">
    </p-button>
  </ng-template>
</p-dialog>
