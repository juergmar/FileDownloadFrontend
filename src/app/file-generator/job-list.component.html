<p-card>
  <ng-template pTemplate="header">
    <div class="jobs-header">
      <div class="header-title">Recent Jobs</div>
      <div class="header-actions">
        <p-button
          icon="pi pi-refresh"
          styleClass="p-button-outlined p-button-sm"
          pTooltip="Refresh job list"
          [loading]="loading"
          (onClick)="onRefreshClicked()"
        ></p-button>
      </div>
    </div>
  </ng-template>

  <div class="jobs-table-container">
    <p-table [value]="jobs" [loading]="loading" styleClass="p-datatable-sm" responsiveLayout="stack"
             [dataKey]="'jobId'" [rowTrackBy]="trackByJobId">
      <ng-template pTemplate="header">
        <tr>
          <th>Type</th>
          <th>File Name</th>
          <th>Status</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-job>
        <tr [ngClass]="{'highlight-row': isJobInProgress(job)}">
          <td>
            <span class="p-column-title">Type</span>
            {{ job.fileType | fileType }}
          </td>
          <td>
            <span class="p-column-title">File Name</span>
            {{ job.fileName || 'Pending...' }}
          </td>
          <td>
            <span class="p-column-title">Status</span>
            <p-tag
              [value]="job.status | jobStatus"
              [severity]="getStatusSeverity(job.status)"
            ></p-tag>
            <span *ngIf="job.progress && job.progress < 100" class="ml-2">
              {{ job.progress }}%
            </span>
          </td>
          <td>
            <span class="p-column-title">Created</span>
            {{ job.createdAt | date:'medium' }}
          </td>
          <td>
            <div class="job-actions">
              <p-button
                icon="pi pi-download"
                styleClass="p-button-success p-button-sm"
                [disabled]="job.status !== 'COMPLETED'"
                pTooltip="Download"
                (onClick)="onDownloadClicked(job.jobId)"
              ></p-button>

              <p-button
                icon="pi pi-times"
                styleClass="p-button-danger p-button-sm"
                [disabled]="!isJobInProgress(job)"
                pTooltip="Cancel"
                (onClick)="onCancelClicked(job.jobId)"
              ></p-button>

              <p-button
                icon="pi pi-refresh"
                styleClass="p-button-warning p-button-sm"
                [disabled]="job.status !== 'FAILED'"
                pTooltip="Retry"
                (onClick)="onRetryClicked(job.jobId)"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="text-center">
            <div *ngIf="loading; else noJobs">
              <div class="skeleton-row" *ngFor="let item of [1,2,3]">
                <p-skeleton width="100%" height="2.5rem"></p-skeleton>
              </div>
            </div>
            <ng-template #noJobs>
              <div class="empty-state">
                <i class="pi pi-file-excel" style="font-size: 3rem; color: #DDD; margin-bottom: 1rem;"></i>
                <p>No recent jobs found</p>
              </div>
            </ng-template>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <!-- Paginator -->
    <div class="paginator-container" *ngIf="totalItems > 0">
      <p-paginator
        [rows]="pageSize"
        [totalRecords]="totalItems"
        [first]="currentPage * pageSize"
        [rowsPerPageOptions]="[5, 10, 20, 50]"
        (onPageChange)="onPageChangeEvent($event)">
      </p-paginator>
    </div>
  </div>
</p-card>
